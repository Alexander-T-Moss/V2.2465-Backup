[gcode_shell_command backup_cfg]
command: sh /home/pi/klipper/scripts/autocommit.sh
timeout: 30.
verbose: True

[gcode_macro BACKUP_CFG]
gcode:
    RUN_SHELL_COMMAND CMD=backup_cfg

[delayed_gcode AUTO_BACKUP_CFG]
initial_duration: 1
gcode:
    RUN_SHELL_COMMAND CMD=backup_cfg

[gcode_macro CONSOLE_MESSAGE]
gcode:
    {% set msg = params.MSG %}
    {action_respond_info(msg)}

[gcode_macro PRIME_LINE]
gcode: 
    G92 E0
    G91
    G1 Z2.0
    G90
    G0 X5 Y5 F18000
    G0 Z0.3
    G0 X5 Y105 Z0.3 F1200 E15
    G0 X6 Y105 Z0.3 F1200
    G0 X6 Y5 Z0.3 F1200 E30
    G92 E0
    G4 P1500
    G91
    G1 Z2.0 F1200
    G90

[gcode_macro UNLOAD_FILAMENT]
description: Unloand the currently loaded filament
gcode:
    {% set temp = params.TEMP|default(250)|int %}
    STATUS_LIGHTS STATUS="heating"
    M104 S150 # Set hotend to 150C
    CG28 # Home all axis if not already homed
    G0 X{printer.toolhead.axis_maximum.x/2} Y10 Z{printer.toolhead.axis_maximum.z/2}
    STATUS_LIGHTS STATUS="heating"
    M109 S{temp} # Set hotend to unload temp and wait
    G1 E-140 F3000 # Retract 140mm of filament
    STATUS_LIGHTS STATUS="standby"